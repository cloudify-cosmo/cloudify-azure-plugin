plugins:
  azure:
    executor: central_deployment_agent
    package_name: cloudify-azure-plugin
    package_version: 3.8.6
data_types:
  cloudify.datatypes.azure.Config:
    properties:
      environment_variables:
        type: dict
        default: {}
      username:
        type: string
        required: false
      password:
        type: string
        required: false
      endpoints_active_directory:
        type: string
        default: https://login.microsoftonline.com
      endpoints_resource_manager:
        type: string
        default: https://management.azure.com
      endpoint_resource:
        type: string
        default: https://management.core.windows.net/
      endpoint_verify:
        type: boolean
        default: true
      subscription_id:
        type: string
        required: false
      tenant_id:
        type: string
        required: false
      client_id:
        type: string
        required: false
      client_secret:
        type: string
        required: false
      scale_name_separator:
        type: string
        required: false
        default: _
      scale_name_suffix_chars:
        type: string
        required: true
        default: '1234567890'
      certificate:
        type: string
        required: false
        default: ''
      thumbprint:
        type: string
        required: false
        default: ''
      cloud_environment:
        type: string
        required: false
        default: ''
  cloudify.datatypes.azure.Common:
    description: >
      The properties, which are common to all types.
    properties:
      name: &id001
        type: string
        required: false
      azure_config: &id002
        type: cloudify.datatypes.azure.Config
        required: false
      client_config: &id003
        type: cloudify.datatypes.azure.Config
        required: false
  cloudify.datatypes.azure.ExistingResources:
    properties:
      use_external_resource: &id004
        type: boolean
        default: false
        required: true
      create_if_missing: &id005
        type: boolean
        required: true
        default: false
      use_if_exists: &id006
        type: boolean
        required: true
        default: false
  cloudify.datatypes.azure.storage.StorageAccountConfig:
    description: >
      See https://msdn.microsoft.com/en-us/library/mt163564.aspx
    properties:
      accountType:
        type: string
        required: false
      networkAcls:
        required: false
      supportsHttpsTrafficOnly:
        required: false
      encryption:
        required: false
      keySource:
        required: false
  cloudify.datatypes.azure.storage.DataDiskConfig:
    properties:
      container_name:
        type: string
        default: vhds
      size:
        default: 20
        required: true
      force_delete:
        default: false
  cloudify.datatypes.azure.storage.FileShareConfig:
    properties:
      metadata:
        required: false
      quota:
        required: false
  cloudify.datatypes.azure.network.VirtualNetworkConfig:
    description: >
      See https://msdn.microsoft.com/en-us/library/mt163661.aspx
    properties:
      addressSpace:
        default:
          addressPrefixes:
            - 10.10.0.0/16
            - 172.16.0.0/16
        required: true
      dhcpOptions:
        required: false
      subnets:
        required: false
  cloudify.datatypes.azure.network.NetworkSecurityGroupConfig:
    description: >
      See https://msdn.microsoft.com/en-us/library/mt163656.aspx
    properties:
      securityRules:
        required: false
  cloudify.datatypes.azure.network.NetworkSecurityRuleConfig:
    description: >
      See https://msdn.microsoft.com/en-us/library/mt163645.aspx
    properties:
      description:
        type: string
        required: false
      protocol:
        type: string
        required: true
      sourcePortRange:
        type: string
        required: false
      destinationPortRange:
        type: string
        required: false
      sourceAddressPrefix:
        type: string
        required: true
      destinationAddressPrefix:
        type: string
        required: true
      access:
        type: string
        required: true
      priority:
        type: integer
        required: true
      direction:
        type: string
        required: true
  cloudify.datatypes.azure.network.SubnetConfig:
    description: >
      See https://msdn.microsoft.com/en-us/library/mt163621.aspx
    properties:
      addressPrefix:
        required: false
      networkSecurityGroup:
        required: false
      routeTable:
        required: false
  cloudify.datatypes.azure.network.RouteTableConfig:
    description: >
      See https://msdn.microsoft.com/en-us/library/mt502548.aspx
    properties:
      routes:
        required: false
  cloudify.datatypes.azure.network.RouteConfig:
    description: >
      See https://msdn.microsoft.com/en-us/library/mt459110.aspx
    properties:
      addressPrefix:
        type: string
        required: true
      nextHopType:
        type: string
        required: true
      nextHopIpAddress:
        type: string
        required: false
  cloudify.datatypes.azure.network.NetworkInterfaceCardConfig:
    description: >
      See https://msdn.microsoft.com/en-us/library/mt163668.aspx
    properties:
      networkSecurityGroups:
        required: false
      ipConfigurations:
        required: false
      dnsSettings:
        required: false
  cloudify.datatypes.azure.network.IPConfigurationConfig:
    properties:
      privateIPAddress:
        type: string
        required: false
      privateIPAllocationMethod:
        type: string
        required: true
  cloudify.datatypes.azure.network.PublicIPAddressConfig:
    description: >
      See https://msdn.microsoft.com/en-us/library/mt163590.aspx
    properties:
      publicIPAllocationMethod:
        type: string
        required: true
      idleTimeoutInMinutes:
        type: integer
        required: false
      domainNameLabel:
        type: string
        required: false
      reverseFqdn:
        type: string
        required: false
  cloudify.datatypes.azure.compute.AvailabilitySetConfig:
    description: >
      See https://msdn.microsoft.com/en-us/library/mt163607.aspx
    properties:
      platformUpdateDomainCount:
        type: integer
        required: false
      platformFaultDomainCount:
        type: integer
        required: false
      sku:
        required: false
  cloudify.datatypes.azure.compute.VirtualMachineSpotConfig:
    description: >
      check the paramaters from this link : https://www.shorturl.at/wHTU2
    properties:
      is_spot_instance:
        type: boolean
        default: false
        required: false
      priority:
        type: string
        default: Spot
        required: false
      eviction_policy:
        type: string
        default: Deallocate
        required: false
      billing_profile:
        default:
          max_price:
            description: >
              the default max price is -1 if it is not provided
            default: -1.0
            required: false
  cloudify.datatypes.azure.compute.VirtualMachineConfig:
    description: >
      https://msdn.microsoft.com/en-us/library/azure/mt163591.aspx
    properties:
      hardwareProfile:
        required: true
      storageProfile:
        required: true
      osProfile:
        required: true
      spot_instance:
        type: cloudify.datatypes.azure.compute.VirtualMachineSpotConfig
        required: false
  cloudify.datatypes.azure.network.LoadBalancerConfig:
    description: >
      See https://msdn.microsoft.com/en-us/library/mt163574.aspx
    properties:
      frontendIPConfigurations:
        required: false
      backendAddressPools:
        required: false
      loadBalancingRules:
        required: false
      probes:
        required: false
      inboundNatRules:
        required: false
  cloudify.datatypes.azure.network.LoadBalancerProbeConfig:
    description: >
      See https://msdn.microsoft.com/en-us/library/mt163574.aspx
    properties:
      protocol:
        type: string
        default: Tcp
        required: true
      port:
        type: integer
        required: true
      requestPath:
        type: string
        required: false
      intervalInSeconds:
        type: integer
        default: 5
        required: true
      numberOfProbes:
        type: integer
        default: 16
        required: true
  cloudify.datatypes.azure.network.LoadBalancerIncomingNATRuleConfig:
    description: >
      See https://msdn.microsoft.com/en-us/library/mt163574.aspx
    properties:
      protocol:
        type: string
        default: Tcp
        required: true
      frontendPort:
        type: integer
        required: true
      backendPort:
        type: integer
        required: true
  cloudify.datatypes.azure.network.LoadBalancerRuleConfig:
    description: >
      See https://msdn.microsoft.com/en-us/library/mt163574.aspx
    properties:
      protocol:
        type: string
        default: Tcp
        required: true
      frontendPort:
        type: integer
        required: true
      backendPort:
        type: integer
        required: true
      enableFloatingIP:
        type: boolean
        required: false
        default: false
      idleTimeoutInMinutes:
        type: integer
        required: false
        default: 5
      loadDistribution:
        type: string
        required: false
        default: Default
  cloudify.datatypes.azure.compute.ManagedClusterConfig:
    description: >
      See https://docs.microsoft.com/en-us/rest/api/aks/managedclusters
    properties:
      location:
        type: string
        default: ''
      tags:
        default: {}
      kubernetes_version:
        type: string
        default: ''
      dns_prefix:
        type: string
        default: ''
      agent_pool_profiles:
        default: []
      linux_profile:
        default: {}
      network_profile:
        default: {}
      windows_profile:
        default: {}
      service_principal_profile:
        default: {}
      addon_profiles:
        default: {}
      enable_rbac:
        type: boolean
        default: true
  cloudify.datatypes.azure.CustomResource:
    description: General use type that can be used with any Azure API in the wheels of the Azure Plugin wagon.
    properties:
      custom_resource_module:
        type: string
        required: true
      custom_resource_class_name:
        type: string
        required: true
      custom_resource_object_name:
        type: string
        required: true
      create_fn_name:
        type: string
        required: true
      update_fn_name:
        type: string
        required: true
      delete_fn_name:
        type: string
        required: true
      get_fn_name:
        type: string
        required: true
        default: get
      get_params:
        type: dict
        required: true
  cloudify.datatypes.azure.CustomResourceOperationConfig:
    description: Mappings for custom operation configs.
    properties:
      create:
        type: dict
        required: true
      update:
        type: dict
        required: false
        default: {}
      delete:
        type: dict
        required: true
node_types:
  cloudify.azure.nodes.ResourceGroup:
    derived_from: cloudify.nodes.Root
    properties:
      name: *id001
      azure_config: *id002
      client_config: *id003
      use_external_resource: *id004
      create_if_missing: *id005
      use_if_exists: *id006
      api_version:
        type: string
        default: '2017-05-10'
      location:
        type: string
        required: false
      tags:
        required: false
      retry_after:
        type: integer
        required: false
    interfaces:
      cloudify.interfaces.lifecycle:
        create: azure.cloudify_azure.resources.resourcegroup.create
        delete: azure.cloudify_azure.resources.resourcegroup.delete
  cloudify.azure.nodes.storage.StorageAccount:
    derived_from: cloudify.nodes.Root
    properties:
      name: *id001
      azure_config: *id002
      client_config: *id003
      use_external_resource: *id004
      create_if_missing: *id005
      use_if_exists: *id006
      api_version:
        type: string
        default: '2015-06-15'
      resource_group_name:
        type: string
        required: false
      location:
        type: string
        required: false
      tags:
        required: false
      sku:
        required: false
      resource_config:
        type: cloudify.datatypes.azure.storage.StorageAccountConfig
        required: true
      retry_after:
        type: integer
        required: false
    interfaces:
      cloudify.interfaces.lifecycle:
        create: azure.cloudify_azure.resources.storage.storageaccount.create
        delete: azure.cloudify_azure.resources.storage.storageaccount.delete
  cloudify.azure.nodes.storage.DataDisk:
    derived_from: cloudify.nodes.Root
    properties:
      name: *id001
      azure_config: *id002
      client_config: *id003
      use_external_resource: *id004
      create_if_missing: *id005
      use_if_exists: *id006
      location:
        type: string
        required: false
      retry_after:
        type: integer
        required: false
      resource_config:
        type: cloudify.datatypes.azure.storage.DataDiskConfig
        required: false
    interfaces:
      cloudify.interfaces.lifecycle:
        create: azure.cloudify_azure.resources.storage.disk.create_data_disk
        delete: azure.cloudify_azure.resources.storage.disk.delete_data_disk
  cloudify.azure.nodes.storage.FileShare:
    derived_from: cloudify.nodes.Root
    properties:
      name: *id001
      azure_config: *id002
      client_config: *id003
      use_external_resource: *id004
      create_if_missing: *id005
      use_if_exists: *id006
      location:
        type: string
        required: false
      storage_account_name:
        type: string
        required: false
      retry_after:
        type: integer
        required: false
      resource_config:
        type: cloudify.datatypes.azure.storage.FileShareConfig
        required: false
    interfaces:
      cloudify.interfaces.lifecycle:
        create: azure.cloudify_azure.resources.storage.file.create
        delete: azure.cloudify_azure.resources.storage.file.delete
  cloudify.azure.nodes.network.VirtualNetwork:
    derived_from: cloudify.nodes.Root
    properties:
      name: *id001
      azure_config: *id002
      client_config: *id003
      use_external_resource: *id004
      create_if_missing: *id005
      use_if_exists: *id006
      api_version:
        type: string
        default: '2016-09-01'
      resource_group_name:
        type: string
        required: false
      location:
        type: string
        required: false
      tags:
        required: false
      resource_config:
        type: cloudify.datatypes.azure.network.VirtualNetworkConfig
        required: false
      retry_after:
        type: integer
        required: false
    interfaces:
      cloudify.interfaces.lifecycle:
        create: azure.cloudify_azure.resources.network.virtualnetwork.create
        delete: azure.cloudify_azure.resources.network.virtualnetwork.delete
  cloudify.azure.nodes.network.NetworkSecurityGroup:
    derived_from: cloudify.nodes.Root
    properties:
      name: *id001
      azure_config: *id002
      client_config: *id003
      use_external_resource: *id004
      create_if_missing: *id005
      use_if_exists: *id006
      api_version:
        type: string
        default: '2016-09-01'
      resource_group_name:
        type: string
        required: false
      location:
        type: string
        required: false
      tags:
        required: false
      resource_config:
        type: cloudify.datatypes.azure.network.NetworkSecurityGroupConfig
        required: false
      retry_after:
        type: integer
        required: false
    interfaces:
      cloudify.interfaces.lifecycle:
        create: azure.cloudify_azure.resources.network.networksecuritygroup.create
        delete: azure.cloudify_azure.resources.network.networksecuritygroup.delete
  cloudify.azure.nodes.network.NetworkSecurityRule:
    derived_from: cloudify.nodes.Root
    properties:
      name: *id001
      azure_config: *id002
      client_config: *id003
      use_external_resource: *id004
      create_if_missing: *id005
      use_if_exists: *id006
      api_version:
        type: string
        default: '2016-09-01'
      resource_group_name:
        type: string
        required: false
      network_security_group_name:
        type: string
        required: false
      location:
        type: string
        required: false
      tags:
        required: false
      resource_config:
        type: cloudify.datatypes.azure.network.NetworkSecurityRuleConfig
        required: false
      retry_after:
        type: integer
        required: false
    interfaces:
      cloudify.interfaces.lifecycle:
        create: azure.cloudify_azure.resources.network.networksecurityrule.create
        delete: azure.cloudify_azure.resources.network.networksecurityrule.delete
  cloudify.azure.nodes.network.Subnet:
    derived_from: cloudify.nodes.Root
    properties:
      name: *id001
      azure_config: *id002
      client_config: *id003
      use_external_resource: *id004
      create_if_missing: *id005
      use_if_exists: *id006
      api_version:
        type: string
        default: '2016-09-01'
      resource_group_name:
        type: string
        required: false
      virtual_network_name:
        type: string
        required: false
      location:
        type: string
        required: false
      tags:
        required: false
      resource_config:
        type: cloudify.datatypes.azure.network.SubnetConfig
        required: false
      retry_after:
        type: integer
        required: false
    interfaces:
      cloudify.interfaces.lifecycle:
        create: azure.cloudify_azure.resources.network.subnet.create
        delete: azure.cloudify_azure.resources.network.subnet.delete
  cloudify.azure.nodes.network.RouteTable:
    derived_from: cloudify.nodes.Root
    properties:
      name: *id001
      azure_config: *id002
      client_config: *id003
      use_external_resource: *id004
      create_if_missing: *id005
      use_if_exists: *id006
      api_version:
        type: string
        default: '2016-09-01'
      resource_group_name:
        type: string
        required: false
      location:
        type: string
        required: false
      tags:
        required: false
      resource_config:
        type: cloudify.datatypes.azure.network.RouteTableConfig
        required: false
      retry_after:
        type: integer
        required: false
    interfaces:
      cloudify.interfaces.lifecycle:
        create: azure.cloudify_azure.resources.network.routetable.create
        delete: azure.cloudify_azure.resources.network.routetable.delete
  cloudify.azure.nodes.network.Route:
    derived_from: cloudify.nodes.Root
    properties:
      name: *id001
      azure_config: *id002
      client_config: *id003
      use_external_resource: *id004
      create_if_missing: *id005
      use_if_exists: *id006
      api_version:
        type: string
        default: '2016-09-01'
      resource_group_name:
        type: string
        required: false
      route_table_name:
        type: string
        required: false
      location:
        type: string
        required: false
      tags:
        required: false
      resource_config:
        type: cloudify.datatypes.azure.network.RouteConfig
        required: false
      retry_after:
        type: integer
        required: false
    interfaces:
      cloudify.interfaces.lifecycle:
        create: azure.cloudify_azure.resources.network.route.create
        delete: azure.cloudify_azure.resources.network.route.delete
  cloudify.azure.nodes.network.NetworkInterfaceCard:
    derived_from: cloudify.nodes.Root
    properties:
      name: *id001
      azure_config: *id002
      client_config: *id003
      use_external_resource: *id004
      create_if_missing: *id005
      use_if_exists: *id006
      api_version:
        type: string
        default: '2016-09-01'
      resource_group_name:
        type: string
        required: false
      location:
        type: string
        required: false
      tags:
        required: false
      primary:
        required: false
        default: false
      resource_config:
        type: cloudify.datatypes.azure.network.NetworkInterfaceCardConfig
        required: false
      retry_after:
        type: integer
        required: false
    interfaces:
      cloudify.interfaces.lifecycle:
        create: azure.cloudify_azure.resources.network.networkinterfacecard.create
        configure: azure.cloudify_azure.resources.network.networkinterfacecard.configure
        start: azure.cloudify_azure.resources.network.networkinterfacecard.start
        delete: azure.cloudify_azure.resources.network.networkinterfacecard.delete
  cloudify.azure.nodes.network.IPConfiguration:
    derived_from: cloudify.nodes.Root
    properties:
      name: *id001
      azure_config: *id002
      client_config: *id003
      use_external_resource: *id004
      create_if_missing: *id005
      use_if_exists: *id006
      api_version:
        type: string
        default: '2016-09-01'
      resource_group_name:
        type: string
        required: false
      location:
        type: string
        required: false
      tags:
        required: false
      resource_config:
        type: cloudify.datatypes.azure.network.IPConfigurationConfig
        required: true
      retry_after:
        type: integer
        required: false
  cloudify.azure.nodes.network.PublicIPAddress:
    derived_from: cloudify.nodes.Root
    properties:
      name: *id001
      azure_config: *id002
      client_config: *id003
      use_external_resource: *id004
      create_if_missing: *id005
      use_if_exists: *id006
      api_version:
        type: string
        default: '2016-09-01'
      resource_group_name:
        type: string
        required: false
      location:
        type: string
        required: false
      tags:
        required: false
      resource_config:
        type: cloudify.datatypes.azure.network.PublicIPAddressConfig
        required: false
      retry_after:
        type: integer
        required: false
    interfaces:
      cloudify.interfaces.lifecycle:
        create: azure.cloudify_azure.resources.network.publicipaddress.create
        start: azure.cloudify_azure.resources.network.publicipaddress.start
        delete: azure.cloudify_azure.resources.network.publicipaddress.delete
  cloudify.azure.nodes.compute.AvailabilitySet:
    derived_from: cloudify.nodes.Root
    properties:
      name: *id001
      azure_config: *id002
      client_config: *id003
      use_external_resource: *id004
      create_if_missing: *id005
      use_if_exists: *id006
      api_version:
        type: string
        default: '2016-03-30'
      resource_group_name:
        type: string
        required: false
      location:
        type: string
        required: false
      tags:
        required: false
      resource_config:
        type: cloudify.datatypes.azure.compute.AvailabilitySetConfig
        required: true
      retry_after:
        type: integer
        required: false
    interfaces:
      cloudify.interfaces.lifecycle:
        create: azure.cloudify_azure.resources.compute.availabilityset.create
        delete: azure.cloudify_azure.resources.compute.availabilityset.delete
  cloudify.azure.nodes.compute.VirtualMachine:
    derived_from: cloudify.nodes.Compute
    properties:
      name: *id001
      azure_config: *id002
      client_config: *id003
      use_external_resource: *id004
      create_if_missing: *id005
      use_if_exists: *id006
      api_version:
        type: string
        default: '2017-03-30'
      resource_group_name:
        type: string
        required: false
      use_public_ip:
        type: boolean
        default: false
      location:
        type: string
        required: false
      tags:
        required: false
      plan:
        required: false
      resource_config:
        type: cloudify.datatypes.azure.compute.VirtualMachineConfig
        required: true
      retry_after:
        type: integer
        required: false
      ip:
        type: string
        required: false
      os_family:
        default: linux
      agent_config:
        type: cloudify.datatypes.AgentConfig
        default:
          install_method: remote
          port: 22
      storage_endpoint:
        type: string
        default: core.windows.net
    interfaces:
      cloudify.interfaces.lifecycle:
        create: azure.cloudify_azure.resources.compute.virtualmachine.virtualmachine.create
        configure: azure.cloudify_azure.resources.compute.virtualmachine.virtualmachine.configure
        start:
          implementation: azure.cloudify_azure.resources.compute.virtualmachine.virtualmachine.start
          inputs:
            command_to_execute:
              default: ''
            file_uris:
              default: []
        stop:
          implementation: azure.cloudify_azure.resources.compute.virtualmachine.virtualmachine.stop
        delete: azure.cloudify_azure.resources.compute.virtualmachine.virtualmachine.delete
      cloudify.interfaces.operations:
        restart: azure.cloudify_azure.resources.compute.virtualmachine.virtualmachine.restart
        resize:
          implementation: azure.cloudify_azure.resources.compute.virtualmachine.virtualmachine.resize
          inputs:
            vm_size:
              type: string
              default: ''
        run_command:
          implementation: azure.cloudify_azure.resources.compute.virtualmachine.virtualmachine.run_command
          inputs:
            command_id:
              type: string
              default: RunShellScript
            script:
              type: list
              default: []
            parameters:
              type: list
              default: []
  cloudify.azure.nodes.compute.WindowsVirtualMachine:
    derived_from: cloudify.azure.nodes.compute.VirtualMachine
    properties:
      os_family:
        default: windows
      agent_config:
        default:
          install_method: remote
          port: 5985
    interfaces:
      cloudify.interfaces.lifecycle:
        start:
          implementation: azure.cloudify_azure.resources.compute.virtualmachine.virtualmachine.start
          inputs:
            command_to_execute:
              default: powershell -ExecutionPolicy Unrestricted -file ps_enable_winrm_http.ps1
            file_uris:
              default:
                - https://raw.githubusercontent.com/cloudify-cosmo/cloudify-azure-plugin/master/scripts/ps_enable_winrm_http.ps1
      cloudify.interfaces.operations:
        run_command:
          implementation: azure.cloudify_azure.resources.compute.virtualmachine.virtualmachine.run_command
          inputs:
            command_id:
              type: string
              default: RunPowerShellScript
            script:
              type: list
              default: []
            parameters:
              type: list
              default: []
  cloudify.azure.nodes.compute.VirtualMachineExtension:
    derived_from: cloudify.nodes.Root
    properties:
      name: *id001
      azure_config: *id002
      client_config: *id003
      use_external_resource: *id004
      create_if_missing: *id005
      use_if_exists: *id006
      api_version:
        type: string
        default: '2016-03-30'
      resource_group_name:
        type: string
        required: false
      virtual_machine_name:
        type: string
        required: false
      location:
        type: string
        required: false
      tags:
        required: false
      retry_after:
        type: integer
        required: false
    interfaces:
      cloudify.interfaces.lifecycle:
        create:
          implementation: azure.cloudify_azure.resources.compute.virtualmachineextension.create
          inputs:
            resource_config:
              default:
                publisher:
                  type: string
                  required: true
                ext_type:
                  description: >
                    Since "type" is a reserved name, "ext_type" maps to "type"
                  type: string
                  required: true
                typeHandlerVersion:
                  type: string
                  required: true
                  default: 1.9
                settings:
                  required: false
        delete: azure.cloudify_azure.resources.compute.virtualmachineextension.delete
  cloudify.azure.nodes.network.LoadBalancer:
    derived_from: cloudify.nodes.Root
    properties:
      name: *id001
      azure_config: *id002
      client_config: *id003
      use_external_resource: *id004
      create_if_missing: *id005
      use_if_exists: *id006
      api_version:
        type: string
        default: '2016-09-01'
      resource_group_name:
        type: string
        required: false
      location:
        type: string
        required: false
      tags:
        required: false
      resource_config:
        type: cloudify.datatypes.azure.network.LoadBalancerConfig
        required: false
      retry_after:
        type: integer
        required: false
    interfaces:
      cloudify.interfaces.lifecycle:
        create: azure.cloudify_azure.resources.network.loadbalancer.create
        configure: azure.cloudify_azure.resources.network.loadbalancer.configure
        delete: azure.cloudify_azure.resources.network.loadbalancer.delete
  cloudify.azure.nodes.network.LoadBalancer.BackendAddressPool:
    derived_from: cloudify.nodes.Root
    properties:
      name: *id001
      azure_config: *id002
      client_config: *id003
      use_external_resource: *id004
      create_if_missing: *id005
      use_if_exists: *id006
      api_version:
        type: string
        default: '2016-09-01'
      resource_group_name:
        type: string
        required: false
      load_balancer_name:
        type: string
        required: false
      location:
        type: string
        required: false
      tags:
        required: false
      retry_after:
        type: integer
        required: false
    interfaces:
      cloudify.interfaces.lifecycle:
        create: azure.cloudify_azure.resources.network.loadbalancer.create_backend_pool
        delete: azure.cloudify_azure.resources.network.loadbalancer.delete_backend_pool
  cloudify.azure.nodes.network.LoadBalancer.Probe:
    derived_from: cloudify.nodes.Root
    properties:
      name: *id001
      azure_config: *id002
      client_config: *id003
      use_external_resource: *id004
      create_if_missing: *id005
      use_if_exists: *id006
      api_version:
        type: string
        default: '2016-09-01'
      resource_group_name:
        type: string
        required: false
      load_balancer_name:
        type: string
        required: false
      location:
        type: string
        required: false
      tags:
        required: false
      resource_config:
        type: cloudify.datatypes.azure.network.LoadBalancerProbeConfig
        required: false
      retry_after:
        type: integer
        required: false
    interfaces:
      cloudify.interfaces.lifecycle:
        create: azure.cloudify_azure.resources.network.loadbalancer.create_probe
        delete: azure.cloudify_azure.resources.network.loadbalancer.delete_probe
  cloudify.azure.nodes.network.LoadBalancer.IncomingNATRule:
    derived_from: cloudify.nodes.Root
    properties:
      name: *id001
      azure_config: *id002
      client_config: *id003
      use_external_resource: *id004
      create_if_missing: *id005
      use_if_exists: *id006
      api_version:
        type: string
        default: '2016-09-01'
      resource_group_name:
        type: string
        required: false
      load_balancer_name:
        type: string
        required: false
      location:
        type: string
        required: false
      tags:
        required: false
      resource_config:
        type: cloudify.datatypes.azure.network.LoadBalancerIncomingNATRuleConfig
        required: false
      retry_after:
        type: integer
        required: false
    interfaces:
      cloudify.interfaces.lifecycle:
        create: azure.cloudify_azure.resources.network.loadbalancer.create_incoming_nat_rule
        delete: azure.cloudify_azure.resources.network.loadbalancer.delete_incoming_nat_rule
  cloudify.azure.nodes.network.LoadBalancer.Rule:
    derived_from: cloudify.nodes.Root
    properties:
      name: *id001
      azure_config: *id002
      client_config: *id003
      use_external_resource: *id004
      create_if_missing: *id005
      use_if_exists: *id006
      api_version:
        type: string
        default: '2016-09-01'
        required: false
      resource_group_name:
        type: string
        required: false
      load_balancer_name:
        type: string
        required: false
      location:
        type: string
        required: false
      tags:
        required: false
      resource_config:
        type: cloudify.datatypes.azure.network.LoadBalancerRuleConfig
        required: false
      retry_after:
        type: integer
        required: false
    interfaces:
      cloudify.interfaces.lifecycle:
        create: azure.cloudify_azure.resources.network.loadbalancer.create_rule
        delete: azure.cloudify_azure.resources.network.loadbalancer.delete_rule
  cloudify.azure.Deployment:
    derived_from: cloudify.nodes.Root
    properties:
      name: *id001
      azure_config: *id002
      client_config: *id003
      use_external_resource: *id004
      create_if_missing:
        type: boolean
        required: true
        default: true
      use_if_exists:
        type: boolean
        required: true
        default: true
      resource_group_name:
        type: string
        default: { get_property: [SELF, name] }
        required: false
      location:
        required: true
        type: string
      template_file:
        type: string
        required: false
      template:
        required: false
      params:
        required: false
        default: {}
    interfaces:
      cloudify.interfaces.lifecycle:
        create: azure.cloudify_azure.resources.deployment.create
        start: azure.cloudify_azure.resources.deployment.pull
        delete: azure.cloudify_azure.resources.deployment.delete
        pull: azure.cloudify_azure.resources.deployment.pull
        update: azure.cloudify_azure.resources.deployment.update
  cloudify.azure.nodes.compute.ContainerService:
    derived_from: cloudify.nodes.Root
    properties:
      name: *id001
      azure_config: *id002
      client_config: *id003
      resource_group:
        required: true
        type: string
      container_service_config:
        type: string
        required: false
    interfaces:
      cloudify.interfaces.lifecycle:
        create:
          implementation: azure.cloudify_azure.resources.compute.container_service.create
          inputs:
            name:
              default: { get_property: [SELF, name] }
            resource_group:
              default: { get_property: [SELF, resource_group] }
            container_service_config:
              default: { get_property: [SELF, container_service_config] }
            azure_config:
              default: { get_property: [SELF, azure_config] }
            client_config:
              default: { get_property: [SELF, client_config] }
        delete:
          implementation: azure.cloudify_azure.resources.compute.container_service.delete
  cloudify.azure.nodes.Plan:
    derived_from: cloudify.nodes.Root
    properties:
      name: *id001
      azure_config: *id002
      client_config: *id003
      use_external_resource: *id004
      create_if_missing: *id005
      use_if_exists: *id006
      resource_group:
        required: true
        type: string
      plan_details:
        required: false
    interfaces:
      cloudify.interfaces.lifecycle:
        create:
          implementation: azure.cloudify_azure.resources.app_service.plan.create
          inputs:
            name:
              default: { get_property: [SELF, name] }
            resource_group:
              default: { get_property: [SELF, resource_group] }
            plan_details:
              default: { get_property: [SELF, plan_details] }
            azure_config:
              default: { get_property: [SELF, azure_config] }
            client_config:
              default: { get_property: [SELF, client_config] }
        delete:
          implementation: azure.cloudify_azure.resources.app_service.plan.delete
  cloudify.azure.nodes.WebApp:
    derived_from: cloudify.nodes.Root
    properties:
      name: *id001
      azure_config: *id002
      client_config: *id003
      use_external_resource: *id004
      create_if_missing: *id005
      use_if_exists: *id006
      resource_group:
        required: true
        type: string
      app_config:
        type: string
        required: false
    interfaces:
      cloudify.interfaces.lifecycle:
        create:
          implementation: azure.cloudify_azure.resources.app_service.webapp.create
          inputs:
            name:
              default: { get_property: [SELF, name] }
            resource_group:
              default: { get_property: [SELF, resource_group] }
            app_config:
              default: { get_property: [SELF, app_config] }
            azure_config:
              default: { get_property: [SELF, azure_config] }
            client_config:
              default: { get_property: [SELF, client_config] }
        delete:
          implementation: azure.cloudify_azure.resources.app_service.webapp.delete
  cloudify.azure.nodes.PublishingUser:
    derived_from: cloudify.nodes.Root
    properties:
      user_details:
        required: true
      azure_config:
        type: cloudify.datatypes.azure.Config
        required: false
      client_config:
        type: cloudify.datatypes.azure.Config
        required: false
    interfaces:
      cloudify.interfaces.lifecycle:
        create:
          implementation: azure.cloudify_azure.resources.app_service.publishing_user.set_user
          inputs:
            user_details:
              default: { get_property: [SELF, user_details] }
            azure_config:
              default: { get_property: [SELF, azure_config] }
            client_config:
              default: { get_property: [SELF, client_config] }
  cloudify.azure.nodes.compute.ManagedCluster:
    derived_from: cloudify.nodes.Root
    properties:
      use_external_resource: *id004
      create_if_missing: *id005
      use_if_exists: *id006
      resource_group:
        required: true
        type: string
      name:
        required: true
        type: string
        default: { get_property: [SELF, cluster_name] }
      cluster_name:
        required: false
        type: string
      resource_config:
        type: cloudify.datatypes.azure.compute.ManagedClusterConfig
        required: true
      store_kube_config_in_runtime:
        type: boolean
        default: true
        required: true
      azure_config:
        type: cloudify.datatypes.azure.Config
        required: false
      client_config:
        type: cloudify.datatypes.azure.Config
        required: false
    interfaces:
      cloudify.interfaces.lifecycle:
        create:
          implementation: azure.cloudify_azure.resources.compute.managed_cluster.create
          inputs:
            resource_group:
              default: { get_property: [SELF, resource_group] }
            cluster_name:
              default: { get_property: [SELF, name] }
            resource_config:
              default: { get_property: [SELF, resource_config] }
            azure_config:
              default: { get_property: [SELF, azure_config] }
            client_config:
              default: { get_property: [SELF, client_config] }
        poststart:
          implementation: azure.cloudify_azure.resources.compute.managed_cluster.store_kubeconf_if_needed
        delete:
          implementation: azure.cloudify_azure.resources.compute.managed_cluster.delete
  cloudify.nodes.azure.ResourceGroup:
    derived_from: cloudify.azure.nodes.ResourceGroup
  cloudify.nodes.azure.storage.StorageAccount:
    derived_from: cloudify.azure.nodes.storage.StorageAccount
  cloudify.nodes.azure.storage.DataDisk:
    derived_from: cloudify.azure.nodes.storage.DataDisk
  cloudify.nodes.azure.storage.FileShare:
    derived_from: cloudify.azure.nodes.storage.FileShare
  cloudify.nodes.azure.network.VirtualNetwork:
    derived_from: cloudify.azure.nodes.network.VirtualNetwork
  cloudify.nodes.azure.network.NetworkSecurityGroup:
    derived_from: cloudify.azure.nodes.network.NetworkSecurityGroup
  cloudify.nodes.azure.network.NetworkSecurityRule:
    derived_from: cloudify.azure.nodes.network.NetworkSecurityRule
  cloudify.nodes.azure.network.Subnet:
    derived_from: cloudify.azure.nodes.network.Subnet
  cloudify.nodes.azure.network.RouteTable:
    derived_from: cloudify.azure.nodes.network.RouteTable
  cloudify.nodes.azure.network.Route:
    derived_from: cloudify.azure.nodes.network.Route
  cloudify.nodes.azure.network.NetworkInterfaceCard:
    derived_from: cloudify.azure.nodes.network.NetworkInterfaceCard
  cloudify.nodes.azure.network.IPConfiguration:
    derived_from: cloudify.azure.nodes.network.IPConfiguration
  cloudify.nodes.azure.network.PublicIPAddress:
    derived_from: cloudify.azure.nodes.network.PublicIPAddress
  cloudify.nodes.azure.compute.AvailabilitySet:
    derived_from: cloudify.azure.nodes.compute.AvailabilitySet
  cloudify.nodes.azure.compute.VirtualMachine:
    derived_from: cloudify.azure.nodes.compute.VirtualMachine
  cloudify.nodes.azure.compute.WindowsVirtualMachine:
    derived_from: cloudify.azure.nodes.compute.WindowsVirtualMachine
  cloudify.nodes.azure.compute.VirtualMachineExtension:
    derived_from: cloudify.azure.nodes.compute.VirtualMachineExtension
  cloudify.nodes.azure.network.LoadBalancer:
    derived_from: cloudify.azure.nodes.network.LoadBalancer
  cloudify.nodes.azure.network.LoadBalancer.BackendAddressPool:
    derived_from: cloudify.azure.nodes.network.LoadBalancer.BackendAddressPool
  cloudify.nodes.azure.network.LoadBalancer.Probe:
    derived_from: cloudify.azure.nodes.network.LoadBalancer.Probe
  cloudify.nodes.azure.network.LoadBalancer.IncomingNATRule:
    derived_from: cloudify.azure.nodes.network.LoadBalancer.IncomingNATRule
  cloudify.nodes.azure.network.LoadBalancer.Rule:
    derived_from: cloudify.azure.nodes.network.LoadBalancer.Rule
  cloudify.nodes.azure.compute.ContainerService:
    derived_from: cloudify.azure.nodes.compute.ContainerService
  cloudify.nodes.azure.Plan:
    derived_from: cloudify.azure.nodes.Plan
  cloudify.nodes.azure.WebApp:
    derived_from: cloudify.azure.nodes.WebApp
  cloudify.nodes.azure.PublishingUser:
    derived_from: cloudify.azure.nodes.PublishingUser
  cloudify.nodes.azure.compute.ManagedCluster:
    derived_from: cloudify.azure.nodes.compute.ManagedCluster
  cloudify.nodes.azure.resources.Azure:
    derived_from: cloudify.azure.nodes.resources.Azure
  cloudify.azure.nodes.resources.Azure:
    derived_from: cloudify.nodes.Root
    properties:
      client_config:
        type: cloudify.datatypes.azure.Config
        required: false
      locations:
        type: list
        default: []
      resource_config:
        type: dict
        default:
          resource_types:
            - Microsoft.ContainerService/ManagedClusters
    interfaces:
      cloudify.interfaces.lifecycle:
        create:
          implementation: azure.cloudify_azure.workflows.resources.initialize
          inputs:
            resource_config:
              default: { get_property: [SELF, resource_config] }
            locations:
              default: { get_property: [SELF, locations] }
        delete:
          implementation: azure.cloudify_azure.workflows.resources.deinitialize
          inputs:
            resource_config:
              default: { get_property: [SELF, resource_config] }
            locations:
              default: { get_property: [SELF, locations] }
  cloudify.nodes.azure.CustomTypes:
    derived_from: cloudify.nodes.Root
    properties:
      client_config:
        type: cloudify.datatypes.azure.Config
        required: false
      location:
        type: string
        default: ''
      api_version:
        type: string
        required: false
      resource_config:
        type: cloudify.datatypes.azure.CustomResource
        required: true
      operation_config:
        type: cloudify.datatypes.azure.CustomResourceOperationConfig
        required: true
    interfaces:
      cloudify.interfaces.lifecycle:
        create:
          implementation: azure.cloudify_azure.custom.create
          inputs:
            resource_config:
              default: { get_attribute: [SELF, resource_config] }
            operation_config:
              default: { get_attribute: [SELF, operation_config, create] }
            location:
              default: { get_property: [SELF, location] }
        start:
          implementation: azure.cloudify_azure.custom.update
          inputs:
            resource_config:
              default: { get_attribute: [SELF, resource_config] }
            operation_config:
              default: { get_attribute: [SELF, operation_config, update] }
            locations:
              default: { get_property: [SELF, location] }
        delete:
          implementation: azure.cloudify_azure.custom.delete
          inputs:
            resource_config:
              default: { get_attribute: [SELF, resource_config] }
            operation_config:
              default: { get_attribute: [SELF, operation_config, delete] }
            locations:
              default: { get_property: [SELF, location] }
relationships:
  cloudify.azure.relationships.contained_in_resource_group:
    derived_from: cloudify.relationships.contained_in
  cloudify.relationships.azure.contained_in_resource_group:
    derived_from: cloudify.azure.relationships.contained_in_resource_group
  cloudify.azure.relationships.contained_in_storage_account:
    derived_from: cloudify.relationships.contained_in
  cloudify.relationships.azure.contained_in_storage_account:
    derived_from: cloudify.azure.relationships.contained_in_storage_account
  cloudify.azure.relationships.contained_in_virtual_network:
    derived_from: cloudify.relationships.contained_in
  cloudify.relationships.azure.contained_in_virtual_network:
    derived_from: cloudify.azure.relationships.contained_in_virtual_network
  cloudify.azure.relationships.contained_in_network_security_group:
    derived_from: cloudify.relationships.contained_in
  cloudify.relationships.azure.contained_in_network_security_group:
    derived_from: cloudify.azure.relationships.contained_in_network_security_group
  cloudify.azure.relationships.contained_in_route_table:
    derived_from: cloudify.relationships.contained_in
  cloudify.relationships.azure.contained_in_route_table:
    derived_from: cloudify.azure.relationships.contained_in_route_table
  cloudify.azure.relationships.contained_in_load_balancer:
    derived_from: cloudify.relationships.contained_in
  cloudify.relationships.azure.contained_in_load_balancer:
    derived_from: cloudify.azure.relationships.contained_in_load_balancer
  cloudify.azure.relationships.network_security_group_attached_to_subnet:
    derived_from: cloudify.relationships.connected_to
    source_interfaces:
      cloudify.interfaces.relationship_lifecycle:
        establish: azure.cloudify_azure.resources.network.subnet.attach_network_security_group
        unlink: azure.cloudify_azure.resources.network.subnet.detach_network_security_group
  cloudify.relationships.azure.network_security_group_attached_to_subnet:
    derived_from: cloudify.azure.relationships.network_security_group_attached_to_subnet
  cloudify.azure.relationships.route_table_attached_to_subnet:
    derived_from: cloudify.relationships.connected_to
    source_interfaces:
      cloudify.interfaces.relationship_lifecycle:
        establish: azure.cloudify_azure.resources.network.subnet.attach_route_table
        unlink: azure.cloudify_azure.resources.network.subnet.detach_route_table
  cloudify.relationships.azure.route_table_attached_to_subnet:
    derived_from: cloudify.azure.relationships.route_table_attached_to_subnet
  cloudify.azure.relationships.nic_connected_to_network_security_group:
    derived_from: cloudify.relationships.connected_to
  cloudify.relationships.azure.nic_connected_to_network_security_group:
    derived_from: cloudify.azure.relationships.nic_connected_to_network_security_group
  cloudify.azure.relationships.nic_connected_to_ip_configuration:
    derived_from: cloudify.relationships.connected_to
    source_interfaces:
      cloudify.interfaces.relationship_lifecycle:
        preconfigure: azure.cloudify_azure.resources.network.networkinterfacecard.attach_ip_configuration
  cloudify.relationships.azure.nic_connected_to_ip_configuration:
    derived_from: cloudify.azure.relationships.nic_connected_to_ip_configuration
  cloudify.azure.relationships.lb_connected_to_ip_configuration:
    derived_from: cloudify.relationships.connected_to
    source_interfaces:
      cloudify.interfaces.relationship_lifecycle:
        postconfigure: azure.cloudify_azure.resources.network.loadbalancer.attach_ip_configuration
  cloudify.relationships.azure.lb_connected_to_ip_configuration:
    derived_from: cloudify.azure.relationships.lb_connected_to_ip_configuration
  cloudify.azure.relationships.ip_configuration_connected_to_subnet:
    derived_from: cloudify.relationships.connected_to
  cloudify.relationships.azure.ip_configuration_connected_to_subnet:
    derived_from: cloudify.azure.relationships.ip_configuration_connected_to_subnet
  cloudify.azure.relationships.ip_configuration_connected_to_public_ip:
    derived_from: cloudify.relationships.connected_to
  cloudify.relationships.azure.ip_configuration_connected_to_public_ip:
    derived_from: cloudify.azure.relationships.ip_configuration_connected_to_public_ip
  cloudify.azure.relationships.connected_to_storage_account:
    derived_from: cloudify.relationships.connected_to
  cloudify.relationships.azure.connected_to_storage_account:
    derived_from: cloudify.azure.relationships.connected_to_storage_account
  cloudify.azure.relationships.connected_to_data_disk:
    derived_from: cloudify.relationships.connected_to
    source_interfaces:
      cloudify.interfaces.relationship_lifecycle:
        establish: azure.cloudify_azure.resources.compute.virtualmachine.virtualmachine.attach_disk
        unlink: azure.cloudify_azure.resources.compute.virtualmachine.virtualmachine.detach_disk
  cloudify.relationships.azure.connected_to_data_disk:
    derived_from: cloudify.azure.relationships.connected_to_data_disk
  cloudify.azure.relationships.connected_to_nic:
    derived_from: cloudify.relationships.connected_to
  cloudify.relationships.azure.connected_to_nic:
    derived_from: cloudify.azure.relationships.connected_to_nic
  cloudify.azure.relationships.connected_to_availability_set:
    derived_from: cloudify.relationships.connected_to
  cloudify.relationships.azure.connected_to_availability_set:
    derived_from: cloudify.azure.relationships.connected_to_availability_set
  cloudify.azure.relationships.connected_to_ip_configuration:
    derived_from: cloudify.relationships.connected_to
  cloudify.relationships.azure.connected_to_ip_configuration:
    derived_from: cloudify.azure.relationships.connected_to_ip_configuration
  cloudify.azure.relationships.connected_to_lb_be_pool:
    derived_from: cloudify.relationships.connected_to
  cloudify.relationships.azure.connected_to_lb_be_pool:
    derived_from: cloudify.azure.relationships.connected_to_lb_be_pool
  cloudify.azure.relationships.connected_to_lb_probe:
    derived_from: cloudify.relationships.connected_to
  cloudify.relationships.azure.connected_to_lb_probe:
    derived_from: cloudify.azure.relationships.connected_to_lb_probe
  cloudify.azure.relationships.vmx_contained_in_vm:
    derived_from: cloudify.relationships.contained_in
  cloudify.relationships.azure.vmx_contained_in_vm:
    derived_from: cloudify.azure.relationships.vmx_contained_in_vm
  cloudify.azure.relationships.nic_connected_to_lb_be_pool:
    derived_from: cloudify.relationships.connected_to
    source_interfaces:
      cloudify.interfaces.relationship_lifecycle:
        establish: azure.cloudify_azure.resources.network.loadbalancer.attach_nic_to_backend_pool
        unlink: azure.cloudify_azure.resources.network.loadbalancer.detach_nic_from_backend_pool
  cloudify.relationships.azure.nic_connected_to_lb_be_pool:
    derived_from: cloudify.azure.relationships.nic_connected_to_lb_be_pool
  cloudify.azure.relationships.vm_connected_to_datadisk:
    derived_from: cloudify.relationships.connected_to
    source_interfaces:
      cloudify.interfaces.relationship_lifecycle:
        establish:
          implementation: azure.cloudify_azure.resources.compute.virtualmachine.virtualmachine.attach_data_disk
          inputs:
            lun:
              default: 0
              required: true
        unlink: azure.cloudify_azure.resources.compute.virtualmachine.virtualmachine.detach_data_disk
  cloudify.relationships.azure.vm_connected_to_datadisk:
    derived_from: cloudify.azure.relationships.vm_connected_to_datadisk
  cloudify.relationships.azure.aks.connected_to_aks_cluster:
    derived_from: cloudify.relationships.connected_to
    target_interfaces:
      cloudify.interfaces.relationship_lifecycle:
        establish:
          implementation: azure.cloudify_azure.resources.compute.managed_cluster.refresh_kubeconfig
        unlink:
          implementation: azure.cloudify_azure.resources.compute.managed_cluster.refresh_kubeconfig
workflows:
  discover_and_deploy:
    mapping: azure.cloudify_azure.workflows.discover.discover_and_deploy
    availability_rules:
      node_instances_active:
        - all
        - partial
      node_types_required:
        - cloudify.nodes.azure.resources.Azure
    parameters:
      node_id:
        type: string
        default: ''
      resource_types:
        type: list
        default:
          - Microsoft.ContainerService/ManagedClusters
      blueprint_id:
        type: string
        default: existing-aks-cluster
